# Product Orders design (DB + API)

## DB entities
- `ProductOrder`: đơn hàng sản phẩm cho user/admin.
- `ProductOrderDetail`: chi tiết item theo snapshot giá + tên + sku tại thời điểm đặt.
- `ProductOrderPayment`: bản ghi thanh toán giả lập SePay (PENDING/PAID/FAILED).

Các field vận chuyển theo yêu cầu hiện tại để mặc định `'-'`:
- `shippingUnit`
- `trackingCode`
- `expectedDelivery`

## User flow
1. FE gọi `POST /api/product-orders` với:
   - `items[]`: `productId`, `qty`, `price` (price chỉ để tham khảo từ FE)
   - `shipping`: thông tin giao hàng
   - `paymentMethod`: `COD | SEPAY`
2. Server validate sản phẩm active + tính lại giá từ DB.
3. Tạo đơn:
   - COD: `status=PROCESSING`, `paymentStatus=NOT_REQUIRED`
   - SEPAY: `status=PENDING_PAYMENT`, `paymentStatus=PENDING`, sinh `paymentCode` + payment record.
4. Trả data giả lập SePay (account/bank/transferContent/qrUrl).

## Polling trạng thái
- FE gọi `GET /api/product-orders/:id` mỗi 3-5s.
- Khi status chuyển `PAID` thì hiển thị thành công.

## Admin flow
- `GET /api/product-orders/admin/list?status=&q=`
- `POST /api/product-orders/admin/:id/mark-paid`
- `PATCH /api/product-orders/admin/:id/status`
